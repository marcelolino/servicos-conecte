
ajuste o pagamento do mercadopago com checkout transparente
âœ… Frontend React â€“ checkout com cartÃ£o e PIX usando SDK do Mercado Pago
âœ… Backend Node.js + Express â€“ processamento seguro dos pagamentos
âœ… Suporte a variÃ¡veis .env â€“ para usar Access Token e Public Key
âœ… Rota para salvar/editar chaves â€“ caso vocÃª queira manter a lÃ³gica do painel admin
âœ… Fluxo do PIX com exibiÃ§Ã£o do QR Code e retorno do status
âœ… Checkout Transparente (sem redirecionar para Mercado Pago)

ğŸ“‚ Estrutura do Projeto
bash
Copiar
Editar
qservicos/
 â”œâ”€â”€ backend/
 â”‚    â”œâ”€â”€ server.js
 â”‚    â”œâ”€â”€ routes/paymentRoutes.js
 â”‚    â”œâ”€â”€ controllers/paymentController.js
 â”‚    â”œâ”€â”€ config/db.js  (se salvar no banco)
 â”‚    â”œâ”€â”€ .env
 â”‚    â””â”€â”€ package.json
 â”‚
 â”œâ”€â”€ frontend/
 â”‚    â”œâ”€â”€ src/Checkout.js
 â”‚    â”œâ”€â”€ src/App.js
 â”‚    â””â”€â”€ package.json
 â”‚
 â””â”€â”€ README.md
ğŸš€ 1. Backend (Node.js)
ğŸ“Œ backend/.env
env
Copiar
Editar
MP_ACCESS_TOKEN=TEST-xxxxxxxxxxxxxxxxxxxxxxxx
MP_PUBLIC_KEY=TEST-xxxxxxxxxxxxxxxxxxxxxxxx
PORT=4000
ğŸ“Œ backend/server.js
js
Copiar
Editar
import express from "express";
import cors from "cors";
import dotenv from "dotenv";
import mercadopago from "mercadopago";
dotenv.config();

const app = express();
app.use(cors());
app.use(express.json());

// Configura Mercado Pago
mercadopago.configure({
  access_token: process.env.MP_ACCESS_TOKEN,
});

// Rota para pagamento com cartÃ£o
app.post("/api/payments/card", async (req, res) => {
  try {
    const payment_data = {
      transaction_amount: Number(req.body.transaction_amount),
      token: req.body.token,
      description: req.body.description,
      installments: Number(req.body.installments),
      payment_method_id: req.body.payment_method_id,
      issuer_id: req.body.issuer_id,
      payer: {
        email: req.body.payer.email,
        identification: {
          type: req.body.payer.identification.type,
          number: req.body.payer.identification.number,
        },
      },
    };

    const payment = await mercadopago.payment.create(payment_data);
    res.json(payment.body);
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

// Rota para pagamento PIX
app.post("/api/payments/pix", async (req, res) => {
  try {
    const payment = await mercadopago.payment.create({
      transaction_amount: Number(req.body.transaction_amount),
      description: req.body.description,
      payment_method_id: "pix",
      payer: { email: req.body.email },
    });
    res.json({
      id: payment.body.id,
      status: payment.body.status,
      qr_code: payment.body.point_of_interaction.transaction_data.qr_code,
      qr_code_base64: payment.body.point_of_interaction.transaction_data.qr_code_base64,
    });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});

app.listen(process.env.PORT, () =>
  console.log(`âœ… Backend rodando na porta ${process.env.PORT}`)
);
ğŸš€ 2. Frontend React
ğŸ“Œ frontend/.env
env
Copiar
Editar
REACT_APP_MP_PUBLIC_KEY=TEST-xxxxxxxxxxxxxxxxxxxxxxxx
ğŸ“Œ frontend/src/Checkout.js
jsx
Copiar
Editar
import React, { useEffect, useState } from "react";
import { initMercadoPago, CardForm } from '@mercadopago/sdk-react';

function Checkout() {
  const [status, setStatus] = useState(null);
  const [qrPix, setQrPix] = useState(null);

  useEffect(() => {
    initMercadoPago(process.env.REACT_APP_MP_PUBLIC_KEY);
  }, []);

  // Pagamento com cartÃ£o
  const handleCardPayment = async (event) => {
    event.preventDefault();
    const formData = window.cardForm.getCardFormData();

    const response = await fetch("http://localhost:4000/api/payments/card", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        token: formData.token,
        transaction_amount: 115.0,
        description: "ServiÃ§o Qservicos",
        installments: formData.installments,
        payment_method_id: formData.paymentMethodId,
        issuer_id: formData.issuerId,
        payer: {
          email: formData.cardholderEmail,
          identification: {
            type: formData.identificationType,
            number: formData.identificationNumber,
          },
        },
      }),
    });

    const result = await response.json();
    setStatus(result.status);
  };

  // Pagamento PIX
  const handlePixPayment = async () => {
    const response = await fetch("http://localhost:4000/api/payments/pix", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ transaction_amount: 115.0, description: "ServiÃ§o Qservicos", email: "cliente@teste.com" }),
    });

    const result = await response.json();
    setQrPix(result.qr_code_base64);
    setStatus(result.status);
  };

  return (
    <div>
      <h2>Checkout QserviÃ§os</h2>

      <h3>ğŸ’³ Pagar com CartÃ£o</h3>
      <form id="form-checkout" onSubmit={handleCardPayment}>
        <CardForm />
        <button type="submit">Pagar com CartÃ£o</button>
      </form>

      <h3>ğŸ“² Pagar com PIX</h3>
      <button onClick={handlePixPayment}>Gerar PIX</button>
      {qrPix && <img src={`data:image/png;base64,${qrPix}`} alt="QR Code PIX" />}

      {status && <p>Status do pagamento: {status}</p>}
    </div>
  );
}

export default Checkout;
âœ… 3. Como rodar no Replit
Crie um projeto Node.js â†’ cole o conteÃºdo da pasta backend.

Crie um projeto React â†’ cole o conteÃºdo da pasta frontend.

Configure as variÃ¡veis .env no painel do Replit.

Inicie os dois servidores (npm start para frontend e backend).

FaÃ§a as chamadas do frontend para o backend (use URL pÃºblica do Replit).